import{a as j}from"./chunk-OGJOIL4K.js";import{a as D}from"./chunk-WKM2OYV4.js";import{a as q}from"./chunk-56V5ULCY.js";import{a as A}from"./chunk-RBWZAM2R.js";import{a as z}from"./chunk-RL5KOLBU.js";import{a as N,b as Y,c as L}from"./chunk-PK5YRH4Z.js";import{a as F}from"./chunk-Q7Y4YLXA.js";import{d as w}from"./chunk-EGESI55J.js";import"./chunk-YOOGVOXO.js";import{Da as T,M as h,Oa as f,Pa as u,Qa as v,R as d,Sa as S,Ta as R,Va as o,Wa as i,Xa as E,ca as x,db as g,mb as O,nb as a,ob as s,qa as l,ub as P,wb as k,xb as I}from"./chunk-LQHLUY7B.js";import{c as y}from"./chunk-2VMXMS7J.js";function B(e,t){if(e>t)throw new Error("DateRange: from must be <= to");return{from:e,to:t}}var C=class e{symptomRepo=d(Y);mealRepo=d(N);medicationRepo=d(L);execute(t=7){return y(this,null,function*(){let n=D(Date.now()-t*864e5),r=D(Date.now()),p=B(n,r),[c,b,M]=yield Promise.all([this.symptomRepo.findByDateRange(p),this.mealRepo.findByDateRange(p),this.medicationRepo.findByDateRange(p)]),H=[...c.map(m=>({type:"symptom",timestamp:m.timestamp,data:m})),...b.map(m=>({type:"meal",timestamp:m.timestamp,data:m})),...M.map(m=>({type:"medication",timestamp:m.timestamp,data:m}))].sort((m,U)=>U.timestamp-m.timestamp),_=new Date().setHours(0,0,0,0);return{timeline:H,todaySymptomCount:c.filter(m=>m.timestamp>=_).length,todayMealCount:b.filter(m=>m.timestamp>=_).length,todayMedicationCount:M.filter(m=>m.timestamp>=_).length}})}static \u0275fac=function(n){return new(n||e)};static \u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"})};function $(e,t){e&1&&E(0,"app-loading-spinner",3)}function J(e,t){e&1&&E(0,"app-empty-state",13)}function K(e,t){e&1&&a(0,"\u{1F37D}\uFE0F")}function Q(e,t){e&1&&a(0,"\u{1F4CA}")}function V(e,t){e&1&&a(0,"\u{1F48A}")}function X(e,t){if(e&1&&(o(0,"div")(1,"span",16),f(2,K,1,0)(3,Q,1,0)(4,V,1,0),i(),o(5,"div",17)(6,"div",18),a(7),i(),o(8,"div",19),a(9),k(10,"relativeTime"),i()()()),e&2){let n,r=t.$implicit,p=g(3);O(P("tl-entry tl-entry--",r.type)),l(2),u((n=r.type)==="meal"?2:n==="symptom"?3:4),l(5),s(p.getEntryTitle(r)),l(2),s(I(10,6,r.timestamp))}}function Z(e,t){if(e&1&&(o(0,"div",14),S(1,X,11,8,"div",15,v),i()),e&2){let n=g(2);l(),R(n.data().timeline.slice(0,20))}}function ee(e,t){if(e&1&&(o(0,"div",4)(1,"div",5)(2,"span",6),a(3),i(),o(4,"span",7),a(5,"\u{1F37D}\uFE0F Repas"),i()(),o(6,"div",5)(7,"span",6),a(8),i(),o(9,"span",7),a(10,"\u{1F4CA} Sympt\xF4mes"),i()(),o(11,"div",5)(12,"span",6),a(13),i(),o(14,"span",7),a(15,"\u{1F48A} M\xE9dicaments"),i()()(),o(16,"div",8)(17,"a",9),a(18,"+ Sympt\xF4me"),i(),o(19,"a",10),a(20,"+ Repas"),i(),o(21,"a",11),a(22,"+ M\xE9dicament"),i()(),o(23,"section")(24,"h2",12),a(25,"Activit\xE9 r\xE9cente"),i(),f(26,J,1,0,"app-empty-state",13)(27,Z,3,0,"div",14),i()),e&2){let n=g();l(3),s(n.data().todayMealCount),l(5),s(n.data().todaySymptomCount),l(5),s(n.data().todayMedicationCount),l(13),u(n.data().timeline.length===0?26:27)}}var G=class e{handler=d(C);toast=d(F);loading=x(!0);data=x(null);ngOnInit(){return y(this,null,function*(){try{this.data.set(yield this.handler.execute(7))}catch{this.toast.error("Erreur lors du chargement")}finally{this.loading.set(!1)}})}getEntryTitle(t){if(t.type==="symptom"){let r=t.data;return j[r.symptomType]+" \u2014 Intensit\xE9 "+r.intensity+"/5"}if(t.type==="meal"){let r=t.data,p=r.ingredients.slice(0,3).map(c=>c.ingredient.name).join(", ");return r.mealType.charAt(0).toUpperCase()+r.mealType.slice(1)+" \u2014 "+(p||"Repas enregistr\xE9")}let n=t.data;return n.medicationName+" \u2014 "+n.dose.amount+" "+n.dose.unit}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=T({type:e,selectors:[["app-dashboard"]],decls:8,vars:1,consts:[[1,"page"],[1,"page-header"],[1,"subtitle"],["message","Chargement..."],[1,"summary-cards"],[1,"card"],[1,"val"],[1,"lbl"],[1,"quick-actions"],["routerLink","/symptoms/new",1,"quick-btn","symptom"],["routerLink","/food-journal/new",1,"quick-btn","meal"],["routerLink","/medications/new",1,"quick-btn","med"],[1,"section-title"],["icon","\u{1F4CB}","title","Aucune entr\xE9e","description","Commencez par enregistrer un repas ou un sympt\xF4me."],[1,"timeline"],[3,"class"],[1,"tl-icon"],[1,"tl-body"],[1,"tl-title"],[1,"tl-time"]],template:function(n,r){n&1&&(o(0,"div",0)(1,"header",1)(2,"h1"),a(3,"GutTrack"),i(),o(4,"p",2),a(5,"Suivi digestif personnel"),i()(),f(6,$,1,0,"app-loading-spinner",3)(7,ee,28,4),i()),n&2&&(l(6),u(r.loading()?6:r.data()?7:-1))},dependencies:[w,z,A,q],styles:[".page[_ngcontent-%COMP%]{padding:1rem;max-width:600px;margin:0 auto}.page-header[_ngcontent-%COMP%]{text-align:center;padding:1rem 0 .5rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#2e7d32;margin:0}.subtitle[_ngcontent-%COMP%]{color:#888;font-size:.85rem;margin:.25rem 0 0}.summary-cards[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin:1rem 0}.card[_ngcontent-%COMP%]{flex:1;background:#f1f8e9;border-radius:12px;padding:1rem;text-align:center;display:flex;flex-direction:column;gap:.25rem}.val[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#2e7d32}.lbl[_ngcontent-%COMP%]{font-size:.75rem;color:#666}.quick-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin:1rem 0}.quick-btn[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;padding:.85rem;border-radius:12px;text-decoration:none;font-weight:600;font-size:.85rem}.quick-btn.symptom[_ngcontent-%COMP%]{background:#e8eaf6;color:#3949ab}.quick-btn.meal[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.quick-btn.med[_ngcontent-%COMP%]{background:#fce4ec;color:#c62828}.section-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;margin:0 0 .75rem}.timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.tl-entry[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;padding:.85rem;border-radius:12px;background:#fafafa}.tl-entry--symptom[_ngcontent-%COMP%]{border-left:3px solid #7986cb}.tl-entry--meal[_ngcontent-%COMP%]{border-left:3px solid #81c784}.tl-entry--medication[_ngcontent-%COMP%]{border-left:3px solid #f48fb1}.tl-icon[_ngcontent-%COMP%]{font-size:1.3rem;flex-shrink:0}.tl-title[_ngcontent-%COMP%]{font-size:.9rem;font-weight:500}.tl-time[_ngcontent-%COMP%]{font-size:.75rem;color:#888;margin-top:.2rem}"]})};export{G as DashboardComponent};
