import{a as fe}from"./chunk-UBMC2IAG.js";import{b as w}from"./chunk-TCRDSWL4.js";import{a as me,c as de}from"./chunk-OF5P4Z6E.js";import{a as ue,b as le}from"./chunk-UB6VBAEX.js";import{a as b}from"./chunk-AUGRQXUW.js";import{a as E}from"./chunk-WKM2OYV4.js";import{a as ie,b as se,c as ae,d as pe,e as ce,f as v}from"./chunk-PK5YRH4Z.js";import{a as te,b as re,f as oe,g as ne}from"./chunk-EGESI55J.js";import"./chunk-YOOGVOXO.js";import{Da as Z,Fb as ee,G as R,J as f,K,Ka as q,M as p,Ma as W,P as z,Q as B,R as y,S as Y,Xa as X,Y as J,ba as H,c as P,f as D,n as l,u,v as V,va as $,z as h,zb as Q}from"./chunk-LQHLUY7B.js";import{a as m,c as i}from"./chunk-2VMXMS7J.js";var G="Service workers are disabled or not supported by this browser",S=class{serviceWorker;worker;registration;events;constructor(t,r){if(this.serviceWorker=t,!t)this.worker=this.events=this.registration=new P(n=>n.error(new f(5601,!1)));else{let n=null,o=new D;this.worker=new P(d=>(n!==null&&d.next(n),o.subscribe(C=>d.next(C))));let a=()=>{let{controller:d}=t;d!==null&&(n=d,o.next(n))};t.addEventListener("controllerchange",a),a(),this.registration=this.worker.pipe(R(()=>t.getRegistration().then(d=>{if(!d)throw new f(5601,!1);return d})));let s=new D;this.events=s.asObservable();let c=d=>{let{data:C}=d;C?.type&&s.next(C)};t.addEventListener("message",c),r?.get(W,null,{optional:!0})?.onDestroy(()=>{t.removeEventListener("controllerchange",a),t.removeEventListener("message",c)})}}postMessage(t,r){return new Promise(n=>{this.worker.pipe(h(1)).subscribe(o=>{o.postMessage(m({action:t},r)),n()})})}postMessageWithOperation(t,r,n){let o=this.waitForOperationCompleted(n),a=this.postMessage(t,r);return Promise.all([a,o]).then(([,s])=>s)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(t){let r;return typeof t=="string"?r=n=>n.type===t:r=n=>t.includes(n.type),this.events.pipe(V(r))}nextEventOfType(t){return this.eventsOfType(t).pipe(h(1))}waitForOperationCompleted(t){return new Promise((r,n)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(V(o=>o.nonce===t),h(1),l(o=>{if(o.result!==void 0)return o.result;throw new Error(o.error)})).subscribe({next:r,error:n})})}get isEnabled(){return!!this.serviceWorker}},Ie=(()=>{class e{sw;messages;notificationClicks;notificationCloses;pushSubscriptionChanges;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new D;constructor(r){if(this.sw=r,!r.isEnabled){this.messages=u,this.notificationClicks=u,this.notificationCloses=u,this.pushSubscriptionChanges=u,this.subscription=u;return}this.messages=this.sw.eventsOfType("PUSH").pipe(l(o=>o.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(l(o=>o.data)),this.notificationCloses=this.sw.eventsOfType("NOTIFICATION_CLOSE").pipe(l(o=>o.data)),this.pushSubscriptionChanges=this.sw.eventsOfType("PUSH_SUBSCRIPTION_CHANGE").pipe(l(o=>o.data)),this.pushManager=this.sw.registration.pipe(l(o=>o.pushManager));let n=this.pushManager.pipe(R(o=>o.getSubscription()));this.subscription=new P(o=>{let a=n.subscribe(o),s=this.subscriptionChanges.subscribe(o);return()=>{a.unsubscribe(),s.unsubscribe()}})}requestSubscription(r){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(G));let n={userVisibleOnly:!0},o=this.decodeBase64(r.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),a=new Uint8Array(new ArrayBuffer(o.length));for(let s=0;s<o.length;s++)a[s]=o.charCodeAt(s);return n.applicationServerKey=a,new Promise((s,c)=>{this.pushManager.pipe(R(I=>I.subscribe(n)),h(1)).subscribe({next:I=>{this.subscriptionChanges.next(I),s(I)},error:c})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(G));let r=n=>{if(n===null)throw new f(5602,!1);return n.unsubscribe().then(o=>{if(!o)throw new f(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((n,o)=>{this.subscription.pipe(h(1),R(r)).subscribe({next:n,error:o})})}decodeBase64(r){return atob(r)}static \u0275fac=function(n){return new(n||e)(B(S))};static \u0275prov=p({token:e,factory:e.\u0275fac})}return e})(),Re=(()=>{class e{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}ongoingCheckForUpdate=null;constructor(r){if(this.sw=r,!r.isEnabled){this.versionUpdates=u,this.unrecoverable=u;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(G));if(this.ongoingCheckForUpdate)return this.ongoingCheckForUpdate;let r=this.sw.generateNonce();return this.ongoingCheckForUpdate=this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:r},r).finally(()=>{this.ongoingCheckForUpdate=null}),this.ongoingCheckForUpdate}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new f(5601,!1));let r=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:r},r)}static \u0275fac=function(n){return new(n||e)(B(S))};static \u0275prov=p({token:e,factory:e.\u0275fac})}return e})();var ge=new z("");function Me(){let e=y(M);if(!("serviceWorker"in navigator&&e.enabled!==!1))return;let t=y(ge),r=y($),n=y(W);r.runOutsideAngular(()=>{let o=navigator.serviceWorker,a=()=>o.controller?.postMessage({action:"INITIALIZE"});o.addEventListener("controllerchange",a),n.onDestroy(()=>{o.removeEventListener("controllerchange",a)})}),r.runOutsideAngular(()=>{let o,{registrationStrategy:a}=e;if(typeof a=="function")o=new Promise(s=>a().subscribe(()=>s()));else{let[s,...c]=(a||"registerWhenStable:30000").split(":");switch(s){case"registerImmediately":o=Promise.resolve();break;case"registerWithDelay":o=ye(+c[0]||0);break;case"registerWhenStable":o=Promise.race([n.whenStable(),ye(+c[0])]);break;default:throw new f(5600,!1)}}o.then(()=>{n.destroyed||navigator.serviceWorker.register(t,{scope:e.scope,updateViaCache:e.updateViaCache,type:e.type}).catch(s=>console.error(K(5604,!1)))})})}function ye(e){return new Promise(t=>setTimeout(t,e))}function Ae(e,t){return new S(e.enabled!==!1?navigator.serviceWorker:void 0,t)}var M=class{enabled;updateViaCache;type;scope;registrationStrategy};function he(e,t={}){return Y([Ie,Re,{provide:ge,useValue:e},{provide:M,useValue:t},{provide:S,useFactory:Ae,deps:[M,J]},q(Me)])}var ve=[{path:"",loadComponent:()=>import("./chunk-F3YFHYRY.js").then(e=>e.ShellComponent),children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>import("./chunk-ZFUSMMQ6.js").then(e=>e.DashboardComponent)},{path:"symptoms",loadComponent:()=>import("./chunk-IOOO5EAR.js").then(e=>e.SymptomListComponent)},{path:"symptoms/new",loadComponent:()=>import("./chunk-HGX6BU7F.js").then(e=>e.SymptomFormComponent)},{path:"food-journal",loadComponent:()=>import("./chunk-6KUD3VXL.js").then(e=>e.MealListComponent)},{path:"food-journal/new",loadComponent:()=>import("./chunk-BFG2LWUJ.js").then(e=>e.MealFormComponent)},{path:"medications",loadComponent:()=>import("./chunk-3MAYC5KT.js").then(e=>e.MedicationListComponent)},{path:"medications/new",loadComponent:()=>import("./chunk-SWNH3BIW.js").then(e=>e.MedicationFormComponent)},{path:"analysis",loadComponent:()=>import("./chunk-6LXBSBML.js").then(e=>e.AnalysisComponent)},{path:"settings",loadComponent:()=>import("./chunk-NJX7DHTZ.js").then(e=>e.SettingsComponent)}]},{path:"**",redirectTo:""}];function Ee(e){return{id:e.id,timestamp:e.timestamp,mealType:e.mealType,ingredients:JSON.stringify(e.ingredients),notes:e.notes,photoId:e.photoId,aiAnalyzed:e.aiAnalyzed}}function O(e){let t=JSON.parse(e.ingredients);return{id:b(e.id),timestamp:E(e.timestamp),mealType:e.mealType,ingredients:t.map(r=>({ingredient:ue(r.ingredient.name,r.ingredient.category,r.ingredient.fodmapLevel),portion:le(r.portion.amount,r.portion.unit)})),notes:e.notes,photoId:e.photoId,aiAnalyzed:e.aiAnalyzed}}var k=class e{db=w();findAll(){return i(this,null,function*(){return(yield this.db.meals.orderBy("timestamp").reverse().toArray()).map(O)})}findByDateRange(t){return i(this,null,function*(){return(yield this.db.meals.where("timestamp").between(t.from,t.to,!0,!0).toArray()).map(O)})}findById(t){return i(this,null,function*(){let r=yield this.db.meals.get(t);return r?O(r):void 0})}save(t){return i(this,null,function*(){yield this.db.meals.put(Ee(t))})}delete(t){return i(this,null,function*(){yield this.db.meals.delete(t)})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})};function be(e){return{id:e.id,timestamp:e.timestamp,symptomType:e.symptomType,intensity:e.intensity,bristolScale:e.bristolScale,notes:e.notes}}function N(e){return{id:b(e.id),timestamp:E(e.timestamp),symptomType:e.symptomType,intensity:me(e.intensity),bristolScale:e.bristolScale?de(e.bristolScale):void 0,notes:e.notes}}var x=class e{db=w();findAll(){return i(this,null,function*(){return(yield this.db.symptoms.orderBy("timestamp").reverse().toArray()).map(N)})}findByDateRange(t){return i(this,null,function*(){return(yield this.db.symptoms.where("timestamp").between(t.from,t.to,!0,!0).toArray()).map(N)})}findById(t){return i(this,null,function*(){let r=yield this.db.symptoms.get(t);return r?N(r):void 0})}save(t){return i(this,null,function*(){yield this.db.symptoms.put(be(t))})}delete(t){return i(this,null,function*(){yield this.db.symptoms.delete(t)})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})};function we(e){return{id:e.id,timestamp:e.timestamp,medicationName:e.medicationName,doseAmount:e.dose.amount,doseUnit:e.dose.unit,notes:e.notes}}function j(e){return{id:b(e.id),timestamp:E(e.timestamp),medicationName:e.medicationName,dose:fe(e.doseAmount,e.doseUnit),notes:e.notes}}var _=class e{db=w();findAll(){return i(this,null,function*(){return(yield this.db.medications.orderBy("timestamp").reverse().toArray()).map(j)})}findByDateRange(t){return i(this,null,function*(){return(yield this.db.medications.where("timestamp").between(t.from,t.to,!0,!0).toArray()).map(j)})}findById(t){return i(this,null,function*(){let r=yield this.db.medications.get(t);return r?j(r):void 0})}save(t){return i(this,null,function*(){yield this.db.medications.put(we(t))})}delete(t){return i(this,null,function*(){yield this.db.medications.delete(t)})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})};var F={aiProvider:"none",correlationWindowHours:8,language:"fr"};var Se="guttrack_settings",U=class e{getSettings(){try{let t=localStorage.getItem(Se);return t?m(m({},F),JSON.parse(t)):m({},F)}catch{return m({},F)}}saveSettings(t){let r=this.getSettings(),n=m(m({},r),t);localStorage.setItem(Se,JSON.stringify(n))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})};var A=class e{settings=y(v);get apiKey(){let t=this.settings.getSettings().claudeApiKey;if(!t)throw new Error("Cl\xE9 API Claude non configur\xE9e");return t}analyzeImage(t,r,n){return i(this,null,function*(){let o=yield fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:"claude-opus-4-6",max_tokens:1024,messages:[{role:"user",content:[{type:"image",source:{type:"base64",media_type:r,data:t}},{type:"text",text:n??"Analyse cette image de repas et identifie les aliments."}]}],system:'Tu es un expert en nutrition et troubles digestifs. R\xE9ponds toujours en JSON valide avec la structure: { "ingredients": [{ "name": string, "category": string, "estimatedPortion": string, "fodmapLevel": "low"|"medium"|"high"|"unknown" }], "mealType": string, "notes": string, "confidence": number }'})});if(!o.ok){let c=yield o.text();throw new Error(`Claude API error: ${o.status} - ${c}`)}let s=(yield o.json()).content[0].text;try{let c=s.match(/\{[\s\S]*\}/);return c?JSON.parse(c[0]):{ingredients:[],confidence:0,notes:s}}catch{return{ingredients:[],confidence:0,notes:s}}})}generateText(t,r){return i(this,null,function*(){let n=yield fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify(m({model:"claude-opus-4-6",max_tokens:2048,messages:[{role:"user",content:t}]},r?{system:r}:{}))});if(!n.ok){let a=yield n.text();throw new Error(`Claude API error: ${n.status} - ${a}`)}return(yield n.json()).content[0].text})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})};var T=class e{analyzeImage(t,r,n){return i(this,null,function*(){return{ingredients:[],confidence:0,notes:"Aucun provider IA configur\xE9. Veuillez configurer une cl\xE9 API dans les param\xE8tres."}})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})};function Ce(e){let t=e.getSettings().aiProvider;return t==="claude"?new A:t==="openai"?new T:new T}function Pe(e){return e.getSettings().aiProvider==="claude"?new A:new T}var Te={providers:[H(),Q({eventCoalescing:!0}),oe(ve,ne()),he("ngsw-worker.js",{enabled:!ee(),registrationStrategy:"registerWhenStable:30000"}),{provide:v,useClass:U},{provide:ie,useClass:k},{provide:se,useClass:x},{provide:ae,useClass:_},{provide:pe,useFactory:Ce,deps:[v]},{provide:ce,useFactory:Pe,deps:[v]}]};var L=class e{static \u0275fac=function(r){return new(r||e)};static \u0275cmp=Z({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(r,n){r&1&&X(0,"router-outlet")},dependencies:[re],encapsulation:2})};te(L,Te).catch(e=>console.error(e));
