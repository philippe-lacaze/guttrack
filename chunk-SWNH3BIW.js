import{a as G}from"./chunk-UBMC2IAG.js";import{a as F,b as L,c as A,d as U,e as I,f as k,g as W,h as R,i as B,j as z,l as V,m as j,n as q}from"./chunk-QBKVUF7L.js";import{a as Y}from"./chunk-AUGRQXUW.js";import{a as T}from"./chunk-WKM2OYV4.js";import{c as D}from"./chunk-PK5YRH4Z.js";import{a as x}from"./chunk-Q7Y4YLXA.js";import{c as P}from"./chunk-EGESI55J.js";import"./chunk-YOOGVOXO.js";import{Da as h,M as C,Oa as b,Pa as E,R as l,Ra as S,Sa as w,Ta as v,Ua as f,Va as o,Wa as r,bb as M,ca as y,db as O,nb as d,ob as N,qa as m,rb as c,sb as p,tb as g}from"./chunk-LQHLUY7B.js";import{c as u}from"./chunk-2VMXMS7J.js";var _=class a{repo=l(D);execute(t){return u(this,null,function*(){let n={id:Y(),timestamp:T(t.timestampMs),medicationName:t.medicationName,dose:G(t.doseAmount,t.doseUnit),notes:t.notes};return yield this.repo.save(n),{id:n.id,timestamp:n.timestamp,medicationName:n.medicationName,doseAmount:n.dose.amount,doseUnit:n.dose.unit,notes:n.notes}})}static \u0275fac=function(n){return new(n||a)};static \u0275prov=C({token:a,factory:a.\u0275fac,providedIn:"root"})};var H={mg:"mg",mcg:"mcg",g:"g",ml:"ml",drops:"gouttes",tablets:"comprim\xE9s",capsules:"g\xE9lules",sachet:"sachet(s)"};function Q(a,t){if(a&1&&(o(0,"option",12),d(1),r()),a&2){let n=t.$implicit,e=O();f("value",n),m(),N(e.LABELS[n])}}function X(a,t){a&1&&d(0,"Enregistrement...")}function Z(a,t){a&1&&d(0,"Enregistrer")}var J=class a{LABELS=H;units=["mg","mcg","g","ml","drops","tablets","capsules","sachet"];handler=l(_);router=l(P);toast=l(x);submitting=y(!1);dt=y(this.nowLocal());name="";doseAmt=1;doseUnit="tablets";notes="";back(){this.router.navigate(["/medications"])}submit(){return u(this,null,function*(){if(!(!this.name||this.submitting())){this.submitting.set(!0);try{yield this.handler.execute({medicationName:this.name,doseAmount:this.doseAmt,doseUnit:this.doseUnit,notes:this.notes||void 0,timestampMs:new Date(this.dt()).getTime()}),this.toast.success("M\xE9dicament enregistr\xE9"),this.router.navigate(["/medications"])}catch{this.toast.error("Erreur lors de l'enregistrement")}finally{this.submitting.set(!1)}}})}nowLocal(){let t=new Date;return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=h({type:a,selectors:[["app-medication-form"]],decls:33,vars:7,consts:[[1,"page"],[1,"ph"],[1,"back",3,"click"],[1,"form",3,"ngSubmit"],[1,"field"],["for","mn",1,"fl"],["id","mn","type","text","name","name","required","","placeholder","Ex: Rifaximine, Lactulose...",1,"fi",3,"ngModelChange","ngModel"],[1,"dose-row"],["for","da",1,"fl"],["id","da","type","number","name","da","min","0.1","step","0.1","required","",1,"fi",3,"ngModelChange","ngModel"],["for","du",1,"fl"],["id","du","name","du",1,"fi",3,"ngModelChange","ngModel"],[3,"value"],["for","mdt",1,"fl"],["id","mdt","type","datetime-local","name","dt",1,"fi",3,"ngModelChange","ngModel"],["for","notes",1,"fl"],["id","notes","name","notes","rows","3","placeholder","Indication, effets...",1,"fi","fi-ta",3,"ngModelChange","ngModel"],["type","submit",1,"btn-primary",3,"disabled"]],template:function(n,e){n&1&&(o(0,"div",0)(1,"header",1)(2,"button",2),M("click",function(){return e.back()}),d(3,"\u2190 Retour"),r(),o(4,"h1"),d(5,"Enregistrer un m\xE9dicament"),r()(),o(6,"form",3),M("ngSubmit",function(){return e.submit()}),o(7,"div",4)(8,"label",5),d(9,"Nom du m\xE9dicament"),r(),o(10,"input",6),g("ngModelChange",function(i){return p(e.name,i)||(e.name=i),i}),r()(),o(11,"div",7)(12,"div",4)(13,"label",8),d(14,"Dose"),r(),o(15,"input",9),g("ngModelChange",function(i){return p(e.doseAmt,i)||(e.doseAmt=i),i}),r()(),o(16,"div",4)(17,"label",10),d(18,"Unit\xE9"),r(),o(19,"select",11),g("ngModelChange",function(i){return p(e.doseUnit,i)||(e.doseUnit=i),i}),w(20,Q,2,2,"option",12,S),r()()(),o(22,"div",4)(23,"label",13),d(24,"Date et heure"),r(),o(25,"input",14),M("ngModelChange",function(i){return e.dt.set(i)}),r()(),o(26,"div",4)(27,"label",15),d(28,"Notes"),r(),o(29,"textarea",16),g("ngModelChange",function(i){return p(e.notes,i)||(e.notes=i),i}),r()(),o(30,"button",17),b(31,X,1,0)(32,Z,1,0),r()()()),n&2&&(m(10),c("ngModel",e.name),m(5),c("ngModel",e.doseAmt),m(4),c("ngModel",e.doseUnit),m(),v(e.units),m(5),f("ngModel",e.dt()),m(4),c("ngModel",e.notes),m(),f("disabled",!e.name||e.submitting()),m(),E(e.submitting()?31:32))},dependencies:[q,k,B,z,F,W,R,L,A,j,V,I,U],styles:[".page[_ngcontent-%COMP%]{padding:1rem;max-width:600px;margin:0 auto}.ph[_ngcontent-%COMP%]{margin-bottom:1.5rem}.ph[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.3rem;font-weight:700;margin:.5rem 0 0}.back[_ngcontent-%COMP%]{background:none;border:none;color:#2e7d32;cursor:pointer;font-size:.9rem;padding:0}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.4rem}.fl[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:#666}.fi[_ngcontent-%COMP%]{padding:.75rem;border:1.5px solid #ddd;border-radius:10px;font-size:.95rem;width:100%;box-sizing:border-box}.fi-ta[_ngcontent-%COMP%]{resize:vertical;min-height:80px;font-family:inherit}.dose-row[_ngcontent-%COMP%]{display:flex;gap:.75rem}.dose-row[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:first-child{flex:2}.dose-row[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:last-child{flex:1}.btn-primary[_ngcontent-%COMP%]{padding:1rem;border-radius:12px;border:none;background:#2e7d32;color:#fff;font-size:1rem;font-weight:600;cursor:pointer}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6}"]})};export{J as MedicationFormComponent};
